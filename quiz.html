<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <h1>Quiz</h1>
    <form id="quiz-form">
        <!-- Questions will be dynamically inserted here -->
    </form>

    <script>
        let quizForm = document.querySelector('#quiz-form');
        let questions = []

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function loadQuiz() {
            quizForm.innerHTML = ''
            fetch('backend/quiz/get.php')
                .then(res => res.json())
                .then(response => {
                    questions = shuffleArray(response)
                    questions.forEach(question => {
                        const questionDiv = document.createElement('div');
                        questionDiv.innerHTML = `
                        <h2>${question.quiz}</h2>
                    `;
                        let options = shuffleArray(question.options)
                        options.forEach(option => {
                            const optionLabel = document.createElement('label');
                            optionLabel.innerHTML = `
                            <input type="radio" name="${question.id}" value="${option}">
                            ${option}
                        `;
                            questionDiv.appendChild(optionLabel);
                        });
                        quizForm.appendChild(questionDiv);
                    });
                })
                .finally(() => {
                    const submitButton = document.createElement('button');
                    submitButton.textContent = 'Submit';
                    quizForm.appendChild(submitButton);
                });
        }

        loadQuiz();

        quizForm.addEventListener('submit', (e) => {
            e.preventDefault()
            let formData = new FormData(quizForm);
            let answers = {};
            formData.forEach((value, key) => {
                answers[key] = value;
            });

            let answersCount = 0
            questions.forEach(question => {
                if (answers[question.id] === question.answer) {
                    answersCount++;
                }
            });

            alert(answersCount + '/' + questions.length)
            quizForm.reset();
            loadQuiz()
        })

    </script>
</body>

</html>